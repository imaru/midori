---
title: "midori6"
author: "Toshihide Imaruoka"
date: "6/21/2022"
output:
  rmdformats::downcute:
    highlight: kate
    css: mycss.css
    dev: "ragg_png"
---
# 6. GLMの応用範囲を広げる--ロジスティック回帰など--
## 6.1 さまざまな種類のデータで応用できるGLM
  * 表6.1: Rのglm()でよく使われる確率分布
    * 離散変数か連続変数か
      * 離散変数
        * 二項分布：成功確率$p$の0/1をn試行実施したときに1となる回数
        * ポアソン分布：平均$\lambda$の度数データをn回取得したときに得られる値
        * 負の二項分布：成功確率$p$の0/1でk回0が出る前に1が出た回数
      * 連続変数
        * ガンマ分布：めったに（$1/\lambda$)起きない事象が$\alpha$回起きるまでの時間
        * 正規分布：負の値も取り得る連続量データ。どういうデータ？
          * 反応時間：正規分布しない。対数正規分布？
          * 正答率：正規分布しない。二項分布？
          * じゃあ、どんなデータ？
          
## 6.2 例題：上限のあるカウントデータ
  * 例題データ：ある植物の$個体_i$の種子$N_i$個を観察したときの生存数$y_i$個。死んでるのは$N_i-y_i$個。体サイズ$x_i$や施肥処理$f_i$が影響する。100個の個体を調べる。
  * データを読み込んで概要をみてみる
  
```{r}
dat<-read.csv('kubobook_2012-2/binomial/data4a.csv')
dat$f<-as.factor(dat$f)
summary(dat)
```
  
## 6.3 二項分布で表現する「あり・なし」カウントデータ
  * 上限があるカウントデータだからポアソン分布では表現できない
  * 二項分布
    * $p(y|N, q)={N \choose y}q^y(1-q)^{N-y}$
      * $p(y|N, q)$: N個中y個で事象が生起する確率。qは事象の生起確率。
      * ${N \choose y}$: 場合の数。N個の観察からy個の生存種子を選び出す場合の数。どのy個でもいいのでそれのこと。
  * $N$を8として$q$を変えて二項分布を書いてみる。
  
```{r}
y<-seq(0,8)
N<-8
d1<-dbinom(y, N, 0.1)
d2<-dbinom(y, N, 0.3)
d3<-dbinom(y, N, 0.8)

# Rのplot()でグラフ
plot(y,d1, type='b', col=1, ylim=c(0,0.5))
par(new=T)
plot(y,d2, type='b', col=2, ylim=c(0,0.5))
par(new=T)
plot(y,d3, type='b', col=3, ylim=c(0,0.5))

# ggplot2でグラフ
# データの加工にtidyverseをつかってる
library(tidyverse)
library(ggplot2)
tdat<-rbind(y,d1,d2,d3) %>% t %>% data.frame %>% tidyr::pivot_longer(!y, names_to = 'd', values_to = 'p')

g<-ggplot(tdat, aes(x=y, y=p, color=d))
g<-g+geom_line()+geom_point()
plot(g)

```
  
## 6.4 ロジスティック回帰とロジットリンク関数

        